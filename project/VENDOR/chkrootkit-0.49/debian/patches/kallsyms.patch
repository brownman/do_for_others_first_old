Author: Francois Marier <francois@debian.org>
Description: ksyms was replaced by kallsyms in 2.6 (#411128)
--- a/chkrootkit
+++ b/chkrootkit
@@ -23,6 +23,14 @@ cd /usr/lib/chkrootkit
 _POSIX2_VERSION=199209
 export _POSIX2_VERSION
 
+# ksyms/kallsyms, depending on kernel version
+if [ `uname -r | cut -d. -f2` -lt 6 ] ;
+then
+KALLSYMS=ksyms ;
+else
+KALLSYMS=kallsyms ;
+fi ;
+
 # Native commands
 TROJAN="amd basename biff chfn chsh cron crontab date du dirname echo egrep \
 env find fingerd gpm grep hdparm su ifconfig inetd inetdconf identd init \
@@ -308,7 +316,7 @@ lkm ()
       fi
 
       if [ "${EXPERT}" = "t" ]; then
-         [ -r /proc/ksyms ] &&  ${egrep} -i "adore|sebek" < /proc/ksyms 2>/dev/null
+         [ -r /proc/$KALLSYMS ] &&  ${egrep} -i "adore|sebek" < /proc/$KALLSYMS 2>/dev/null
          [ -d /proc/knark ] &&  ${ls} -la /proc/knark 2> /dev/null
          PV=`$ps -V 2>/dev/null| $cut -d " " -f 3 |${awk} -F . '{ print $1 "." $2 $3 }' | ${awk} '{ if ($0 > 3.19) print 3; else if ($0 < 2.015) print 1; else print 2 }'`
          [ "$PV" = "" ] &&  PV=2
@@ -318,14 +326,14 @@ lkm ()
       fi
 
       ### adore LKM
-      [ -r /proc/ksyms ] && \
-      if `${egrep} -i adore < /proc/ksyms >/dev/null 2>&1`; then
+      [ -r /proc/$KALLSYMS ] && \
+      if `${egrep} -i adore < /proc/$KALLSYMS >/dev/null 2>&1`; then
          echo "Warning: Adore LKM installed"
       fi
 
       ### sebek LKM (Adore based)
-      [ -r /proc/ksyms ] && \
-      if `${egrep} -i sebek < /proc/ksyms >/dev/null 2>&1`; then
+      [ -r /proc/$KALLSYMS ] && \
+      if `${egrep} -i sebek < /proc/$KALLSYMS >/dev/null 2>&1`; then
          echo "Warning: Sebek LKM installed"
       fi
 
